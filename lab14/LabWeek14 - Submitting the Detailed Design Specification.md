Lab Week 14: Submitting the Detailed Design Specification 

https://github.com/EstherBear/SoftwareEngineering

# 0 人员介绍

| 姓名                 | 学号     |      | 姓名   | 学号     |
| -------------------- | -------- | ---- | ------ | -------- |
| 劳倩茹（版本管理员） | 18340086 |      | 吴天   | 19334019 |
| 刘思然               | 19335141 |      | 赖奕恺 | 19335093 |

# 1 引言

## 1.1 编写目的

本文档的目的是详细地介绍人工智能(AI)教学在线评测与游戏网站的详细设计，说明对程序系统的设计考虑，以便项目开发人员了解产品大致和详细的设计与实现。本文将结合文字描述，概念图、组件图，以及关系图等UML图来描述对网站系统的模块结构设计和程序的详细设计。本文档的预期读者是开发人员和维护人员，以及跟该项目相关的其他人员。

## 1.2 背景

1. 待开发软件系统的名称: 

   人工智能(AI)教学在线评测与游戏网站。

2. 待开发软件系统的信息:

| 任务提出者           | 蔡国扬                             |
| -------------------- | ---------------------------------- |
| 开发者               | 劳倩茹、刘思然、吴天、赖奕恺       |
| 用户                 | 面向学习者、教学者和开发者三种角色 |
| 将运行该软件的计算站 | 阿里云服务器                       |

## 1.3 定义

以下是说明书中会出现的各种术语的定义，以及各种简写和缩略语，以便读者阅读时进行参考。

| 术语、简写和缩略语 | 解释                                                         |
| ------------------ | ------------------------------------------------------------ |
| Html               | 超文本标记语言，是一种用于创建网页的标准标记语言             |
| CSS                | 层叠样式表(英文全称：Cascading Style Sheets)是一种用来表现HTML文件样式的计算机语言 |
| JavaScript         | JavaScript（简称“JS”） 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言 |
| JSON               | JSON(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。 |
| React              | React是用于构建用户界面的JavaScript库                        |
| HTTP               | HyperText Transfer Protocol，超文本传输协议                  |
| WebSocket          | WebSocket是一种在单个TCP连接上进行全双工通信的协议           |
| DDS                | Data Distribution Service for Real-Time Systems，是一种物联网协议 |
| Flask              | Flask是具备的扩展性和兼容性的web开发框架                     |
| SqLite             | SqLite是一个完全独立的、不要任何配置、支持SQL的、开源的文件数据库引擎 |
| Vakuum             | 一个采用MVC（模型-视图-控制器）架构设计的判题系统            |

## 1.4 参考资料

- 《GB/T 8567-1988 计算机软件产品开发文件编制指南》

# 2 程序系统的结构

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272819.assets)

整个项目采取了高内聚低耦合的设计方向，将整个项目的不同功能交付给不同的功能模块来独立的完成，降低不同程序直接的耦合程度，程序协作之间的干扰程度低，不同程序的权限彼此分离，提高了信息系统的开发质量和开发效率，进而为日后的更新与维护提供很大的方便。 

在本项目中，主要包含了以下6个模块：

- 登录模块：提供给用户在网站登录和注册的功能
- 前端页面模块: 运行在浏览器上展现给用户浏览的网页，管理与用户交互 
- 评测模块：提供给用户在网站提交代码，并以游戏形式显示运行结果的功能 
- 课程模块：实现了项目的教学功能
- 社区模块：实现了项目的社区功能
- 数据治理模块：项目中所有数据库的顶层管理者，接受来自其他程序模块的数据请求，返回其他模块所请求数据 

对于每个单独的模块，我们采取了分层的架构进行设计，主要包含表示层UI和业务逻辑层BLL。在表示层中，我们暴露出不同模块之间相互通信的接口，在业务逻辑层中，每个单独的模块又包含了大量的子程序，例如内存管理子程序、消息监听子程序、合法性检验子程序，业务逻辑实现子程序，通信实现子程序等等，这些子程序之间相互协作，接受来自用户的输入，通过内部的业务逻辑和对其他模块的数据交互，消息通信，完成用户的请求，返回对应的输出。具体模块功能实现详见下面单独的模块介绍

# 3 程序1——登录模块设计说明

## 3.1 程序描述

登录模块提供给用户在网站登录和注册的功能，方便用户查看自己的历史使用情况，同时也方便网站管理用户，并为后续提供用户定制化服务奠定基础。

本程序应该具有如下特点：

- 用户24h都有可能登陆网站，所以本程序以服务形式在服务器后台运行，24小时监听请求接口。
- 用户的信息需要高度的安全性，所以本程序是线程安全的程序。
- 可能涉及多模块调用以及多用户请求，所以本程序是并发处理程序。

## 3.2 功能

登录模块主要提供注册和登录两个功能。

若用户选择登录，程序接收用户输入的用户名和密码，判断用户名是否和用户列表数据库中的某一条记录匹配并且密码相同，如果是，输出登录成功；否则，输出登录失败，并等待用户重新输入。

若用户选择注册，程序接收用户输入的新用户名和密码，判断用户名是否和用户列表数据库中的某一条记录匹配或者密码是否过于简单，如果是，输出注册失败，并等待用户重新输入；否则，输出注册成功。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427211.assets)

## 3.3 性能

说明对该程序的全部性能要求 包括对精度 灵活性和时间特性的要求。

登录模块的性能有如下要求：

- 精度方面：由于登陆注册的数据只涉及字符串变量，所以没有特别的要求，只限制用户名不超过100个字符，密码不超过50个字符。
- 灵活性：此模块功能简单，所以本身就具有灵活性的特点。
- 时间特性：
  - 此模块除了对数据库进行修改外不应有其他副作用，可以一直运行。
  - 此模块本身不涉及耗时的算法，应该有较短的响应时间。

## 3.4 输入项

用户输入的信息，包括用户名和密码字符串，Register or Login选项。

## 3.5 输出项

返回给用户提示消息，指示登录/注册是否成功。

## 3.6 算法

输入：isLogin, username, passward

输出：message

算法：判读是否是登录请求

1. 若是登录请求，查询用户名和密码是否和已有的用户记录匹配。
   1. 若查询到匹配的用户记录，调用登录接口，返回登录成功信息。
   2. 否则，返回登录失败信息。
2. 若是注册请求，查询新用户名和已有的用户名记录是否匹配以及密码是否过于简单。
   1. 若新用户名和已有的用户名记录匹配或者密码过于简单，返回注册失败信息。
   2. 否则，调用注册接口，返回登陆成功信息。

## 3.7 流程逻辑

登录模块的流程逻辑如下：

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427222.assets)

## 3.8 接口

登录模块连接前端以及数据治理模块，它接收来自前端的请求，简单的逻辑处理后，向数据治理模块发出对应的查询请求，得到结果后再经过简单的逻辑处理，把结果信息返回给前端。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427223.assets)

## 3.9 存储分配 

基于后台服务长期挂载进程。因此登录模块所需要的一些局部变量、传输资源都由编写该模块的高级语言进行申请。

## 3.10 注释设计 

 本程序中安排的注释如下：

- 在模块首部注释说明模块的创作者、编写时间及版本和基本功能。
- 在变量声明阶段，说明变量的功能、范围和缺省条件等。
- 对函数的基本描述和输入输出进行注释。
- 对逻辑比较难理解的语句和分支进行注释。

## 3.11 限制条件 

登录模块包括如下限制条件

- 登录模块必须长期以后台服务形式运行在服务器，避免进程被挂起或kill
- 登录模块必须能处理多用户请求，所以要以多线程/多进程方式部署。

## 3.12  测试计划 

测试数据：随机模拟并生成一系列用户行为，比如多组用户名和密码。

测试人员：本小组开发人员共同测试。

测试方法：采取回归测试，编写自动测试脚本和样例。每次修改登录模块的代码后，重新进行测试以确认修改没有引入新的错误或导致其他代码产生错误。

结果规定：要求登录模块能够在规定的时间内返回注册/登录结果，并确保用户相关信息更新的正确性和一致性。

## 3.13 尚未解决的问题

暂无

# 4 程序2——前端页面模块设计说明

## 4.1 程序描述

前端页面模块即网站前台部分，是运行在PC端，移动端等浏览器上展现给用户浏览的网页。网页存储在Web服务器上，当用户需要查看网页时，浏览器将经历一系列过程，将网页渲染呈现给用户。前端页面模块所具备的特点如下：

- 为非常驻内存程序，仅在浏览器进行浏览时在用户内存中。
- 浏览器中的JS引擎是单线程的（解析JS是单线程的），但浏览器是多进程的。因此该模块主要是单线程，也包括部分异步操作。

## 4.2 功能

前端页面模块主要管理与用户交互的功能。一方面， 前端页面模块将根据用户的输入，进行合法性检测，检测通过后给后端发送相应的请求，另一方面， 前端页面模块能够把从后端获取的结果呈现到各个页面上。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427234.assets)

## 4.3 性能

前端页面模块的性能要求如下：

- 精度：在JS中数字是采用 IEEE 754 标准的 64 位双精度浮点数。
- 灵活性：主流网络浏览器（chrome、FireFox等）上均可以使用。
- 时间特性：用户响应时间与界面更新应当在 1 秒内完成，小型数据传输应当在 2 秒内完成，较大文件传输则应当在 30 秒内完成。

## 4.4 输入项

前端页面模块的输入均为来自用户的请求数据。

## 4.5 输出项

前端页面模块的输出均为来自后端服务器返回的数据，或错误类型和错误信息。

## 4.6 算法

前端界面模块进行一定的并发控制：当请求数大于指定的阀值时，将剩余请求存起来，等待有请求请求完毕后，再推出。

输入：来自用户的输入

输出：返回给用户页面展示

算法流程：

判读请求数是否大于指定的阀值

1. 若请求数不大于指定阈值

直接将所有用户请求都发送给后端。

1. 若请求数大于指定阈值
   1. 超过阈值的请求进行await，状态设置为pending。
   2. 如果有请求执行完毕就推出一个，将状态置为Fulfilled

## 4.7 流程逻辑

前端界面模块的逻辑流程如下：

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427235.assets)

## 4.8 接口

前端界面模块连接用户以及除数据治理模块的其他所有模块，它接收来自用户的请求，向除数据治理模块的其他模块发出对应的请求，并接收返回结果再展示给用户。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427236.assets)

## 4.9 存储分配 

由高级编程语言JS自动进行内存的管理。当申明变量、函数、对象的时候，系统会自动为他们分配内存。当使用完毕，由垃圾回收机制自动回收不再使用的内存。

## 4.10 注释设计 

- 在模块首部注释说明模块开始编写时间、编写人员及其基本功能
- 在变量声明阶段，大概说明变量的类型和用途
- 在判断、循环或者顺序枝分点上注释说明程序代码的功能

## 4.11 限制条件 

 必须保证网络稳定，程序能够正常地连接到服务器。

## 4.12  测试计划 

测试数据：随机模拟并生成一系列用户行为，包含合法的用户输入和非法的用户输入。

测试人员：本小组开发人员共同测试。

测试方法：采用黑盒测试，通过测试来检测每个功能是否都能正常使用。采取回归测试，编写自动测试脚本和样例。每次修改前端界面模块的代码后，重新进行测试以确认修改没有引入新的错误或导致其他代码产生错误。

结果规定：要求前端界面模块能够在规定的时间内返回结果。

## 4.13 尚未解决的问题

支付功能的开发需要支付宝平台的接口授权，暂未取得支付宝方的授权、签约。

# 5 程序3——评测模块设计说明

## 5.1 程序描述

评测模块提供给用户在网站提交代码，并以游戏形式显示运行结果的功能。用户可以以方便又不失趣味性的方式学习AI算法。

本程序应该具有如下特点：

- 用户24h都有可能登陆网站，所以本程序以服务形式在服务器后台运行，24小时监听请求接口。
- 用户提交的代码的执行不能攻击系统，所以本程序必须使用安全沙箱执行用户代码。
- 可能涉及多用户请求，所以本程序是并发处理程序，使用队列形式接收判题请求，每个请求可以用一个评测节点进行处理。

## 5.2 功能

评测模块主要提供对代码文件进行评测并返回结果的功能。

具体来说，评测模块会把用户提交的代码文件分配给一个评测节点，评测节点会对代码进行评测，如果没有编译错误，返回代码的评分以及AI游戏的控制序列，评分直接返回给前端，而控制序列发送给游戏引擎方便其显示画面；否则返回编译错误。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427247.assets)

## 5.3 性能

评测模块的性能有如下要求：

- 精度方面：代码文件大小不超过5MB。
- 灵活性：对于新用户，只需要fork一个新的judger，具有可扩展性。
- 时间特性：
  - 此模块除了对数据库进行修改外不应有其他副作用，可以一直运行。
  - 此模块应该可以同时支持多个用户，并且有较短的响应时间。

## 5.4 输入项

用户提交的代码文件或是部分代码片段

## 5.5 输出项

用户提交的代码的得分以及运行过程中产生的动作序列。

## 5.6 算法

输入：Code File

输出：代码的运行结果

算法：

1. 评测服务器接收到代码文件后会进行基本的检查，然后放入消息队列。
2. 消息队列中的评测请求会由评测节点进行处理。
3. 评测节点会返回评测结果：
   1. 若出现编译错误，返回出错信息。
   2. 否则，返回分数和动作序列，分数直接返回给前端，动作序列发送到游戏引擎。

## 5.7 流程逻辑

评测模块的流程逻辑如下：

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427248.assets)

## 5.8 接口

评测模块接收来自前端的请求，简单的逻辑处理后，调用评测节点完成评测结果。根据评测结果，向数据治理模块发出对应的修改用户数据的请求。最后把评测分数返回给前端，并把游戏的动作序列发送给游戏引擎。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-16530406427259.assets)

## 5.9 存储分配 

基于后台服务长期挂载进程。因此评测模块所需要的一些局部变量、传输资源都由编写该模块的高级语言进行申请。另外，评测模块在接收到更多用户请求后，会按需增加评测节点的数量，也会消耗存储资源，但是会有一个上限。

## 5.10 注释设计 

 本程序中安排的注释如下：

- 在模块首部注释说明模块的创作者、编写时间及版本和基本功能。
- 在变量声明阶段，说明变量的功能、范围和缺省条件等。
- 对函数的基本描述和输入输出进行注释。
- 对逻辑比较难理解的语句和分支进行注释。

## 5.11 限制条件 

评测模块包括如下限制条件

- 评测模块必须长期以后台服务形式运行在服务器，避免进程被挂起或kill
- 评测模块必须能处理多用户请求，所以要以多线程/多进程方式部署。

## 5.12  测试计划 

测试数据：随机模拟并生成一系列用户行为，比如多个代码文件。

测试人员：本小组开发人员共同测试。

测试方法：采取回归测试，编写自动测试脚本和样例。每次修改评测模块的代码后，重新进行测试以确认修改没有引入新的错误或导致其他代码产生错误。

结果规定：要求评测模块能够正确返回评测结果，并且可以在多用户情况下也保持一定的响应速度。

## 5.13 尚未解决的问题

暂无

# 6 程序4——课程模块设计说明

## 6.1 程序描述

课程模块实现了项目的教学功能，在该模块中，教师可以发布教学资料，能用课程管理学生的学习进度和对学生的学习情况进行统计了解。课程模块是课程相关功能的子程序的集合，包含了课程管理、作业管理、课程考试三个子程序。除了账号互通和数据存储以外，课程模块的程序与其他模块隔离，具有一定的独立性，便于课程模块的更新和功能的扩展。课程模块具备以下特点：

- 为独立的常驻内存程序，具备独立的内存区和运行进程
- 是不可重入程序，其他程序或调用不能对该模块进行中断
- 是并发处理程序，不同用户针对课程的不同请求可以由该程序的多个进程并行并发处理
- 是同步通信程序，单个进程直到完成用户的一条操作请求后才会进行下一条请求的处理

## 6.2 功能

课程模块包含了如下功能：

- 学习者可以根据课程ID加入到由特定教学者创建的课程中进行学习；也可以通过自由搜索、选择其他教学者用户发布的网课视频进行自由学习。
- 学习者可以管理自己加入的课程列表，包括对课程进行删除、评分等功能。
- 学习者在加入课程后，可以根据教学者的要求提交作业，并得到来自教学者的批改反馈。
- 学习者可以根据教学者的要求，参加教学者建立的考试进行水平检测。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272510.assets)

## 6.3 性能

 课程模块的性能要求如下：

- 精度方面：高精度要求，存储数据信息采取全量信息存储而不是压缩存储，保持信息的完整性，使得支持用户的模糊搜索等功能。
- 灵活性：
  - 对具有相互冲突数据的操作请求，使用节点链表进行排队，避免发生互斥
  - 课程模块进程进行操作请求的实现前进行死锁避免检查，如若进行该请求可能与其他进程已经进行的请求发现死锁，则对节点链表的请求顺序进行重排序和调度。
- 时间特性：
  - 要求每个操作请求都能在限定的短时间内得到处理，避免出现请求饥饿
  - 要求每个操作请求都能在限定的短时间内完成，避免用户等待延迟大

## 6.4 输入项

来自前端模块的用户的不同操作。用户的不同操作均建模为统一形式的输入请求，其包括用户请求的操作类型，用户的标识信息，用户请求的操作内容（例如加入的课程号等）等内容。

## 6.5 输出项

用户操作得到的结果，或运行产生的错误信息。

## 6.6 算法

输入：来自用户的不同操作请求

输出：用户操作返回的结果

算法流程：

1. 课程模块持续监听，接收请求
2. 前端模块接收来自用户的操作，将请求发送给课程模块
3. 课程模块将请求在链表上排队
4. 检查程序对当前请求和已调度请求进行死锁检查
5. 调度进程池的空闲进程来处理请求
6. 向数据治理模块发出对应的数据请求
7. 根据用户权限和请求数据等信息完成操作请求
8. 返回给用户对应的状态信息

## 6.7 流程逻辑

课程模块的流程逻辑如下：

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272611.assets)

## 6.8 接口

课程模块与前端模块、数据治理模块进行通信交互，相互查询和交换数据信息。此外，课程模块具备死锁检查子程序，进程调度子程序，进程池维护子程序，交互通信子程序，业务逻辑子程序等等，它们彼此的相互合作，完成了接收来自用户的操作请求，返回给用户相应的状态信息。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272612.assets)

## 6.9 存储分配 

- 课程模块将课程资料、学生成绩数据、考试等数据存储到独立的文件服务器 / 数据库中。
- 程序中的各个变量、结构体、函数由编程语言自动分配内存和进行内存的使用与释放。
- 预先申请了一整块连续的内存存储，用来维护进程池。

## 6.10 注释设计 

- 在模块首部注释说明模块开始编写时间、编写人员及其基本功能。
- 在变量声明阶段，大概说明变量的类型和用途。
- 在判断、循环或者顺序枝分点上注释说明程序代码的功能。

## 6.11 限制条件 

课程模块包括如下限制条件：

- 课程模块必须长期运行在服务器后端后台，避免进程被挂起或kill。
- 课程模块必须能处理多用户请求，所以要以多线程/多进程方式部署。
- 课程模块基于HTTP协议等与前端模块通信，必须保证通信线路的稳定和网络的稳定。

## 6.12  测试计划 

测试数据：随机生成一系列用户请求，包括等创建课程、加入课程、学习网课等行为。

测试人员：本小组开发人员共同测试

测试方法：采取白盒测试法，对课程模块的逻辑结构、循环结构和执行的基本路径进行检验。通过检查软件内部的逻辑结构，对软件中的逻辑路径进行覆盖测试。在程序不同地方设立检查点，检查程序的状态，以确定实际运行状态与预期状态是否一致。

结果规定：要求课程模块能够接收用户请求，并在规定的时间内响应并完成用户的操作请求。

## 6.13 尚未解决的问题

 暂无

# 7 程序5——社区模块设计说明

## 7.1 程序描述

社区模块是实现了整个项目的社区功能，不同角色的用户可以在社区系统发布自己的博客，搜索他人的博客，对知识进行问答等等。社区模块是一个独立的子程序集合，包含了实现社区不同功能的多个不同功能的子程序。该模块在设计上具有独立性和完整性，和其他的模块相互隔离，结构清晰，容易扩展。详细的讲，我们构建社区模块具备以下特点：

- 为独立的常驻内存程序，具备独立的内存区和运行进程
- 是不可重入程序，其他程序或调用不能对该模块进行中断
- 是并发处理程序，不同用户针对社区的不同请求可以由该程序的多个进程并行并发处理
- 是同步通信程序，单个进程直到完成用户的一条操作请求后才会进行下一条请求的处理

## 7.2 功能

社区模块实现了多种多样的社区功能，其主要包括：

- 用户发表和管理自己的博客，查看和评论他人的博客，搜索特定的博客
- 用户建立话题，发起自己问题，回答他人的问题
- 热门话题、博客、问答推荐
- 收藏、关注、分享他人的博客、问答等

以上的这些功能我们用统一的端到端模式进行实现，不同的功能操作我们视为具有特定标识的输入。用户发起操作后，对应的操作请求被发送给社区模块，由社区模块内部的子程序完成详细实现，包括与其他模块的交互（例如和数据治理模块的交互：请求新数据、将数据写入数据库等等），权限的变更，状态的更新等等。社区模块完成操作后，返回对应的提示信息，来提示用户操作成功或失败。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272613.assets)

## 7.3 性能

社区模块呈现呈现多用户，高并发，多请求的特点，用户往往希望自己对社区的操作能在非常短的时间内得到响应并完成，因此我们对其性能进行如下要求：

- 精度方面：高精度要求，存储数据信息采取全量信息存储而不是压缩存储，保持信息的完整性，使得支持用户的模糊搜索等功能。
- 灵活性：
  - 对具有相互冲突数据的操作请求，使用节点链表进行排队，避免发生互斥
  - 社区模块进程进行操作请求的实现前进行死锁避免检查，如若进行该请求可能与其他进程已经进行的请求发现死锁，则对节点链表的请求顺序进行重排序和调度。
- 时间特性：
  - 要求每个操作请求都能在限定的短时间内得到处理，避免出现请求饥饿
  - 要求每个操作请求都能在限定的短时间内完成，避免用户等待延迟大

## 7.4 输入项

我们将用户的不同操作均建模为统一形式的输入请求，其包括用户请求的操作类型，用户的标识信息，用户请求的操作内容（例如请求搜索的博客标题、请求发布的博客内容等等）等内容

## 7.5 输出项

社区模块接收来自用户的输入，在内部完成与其他模块的交互，权限的变更，状态的更新等动作来完成用户的操作请求，最后返回给用户对应的提示信息，来提示用户操作成功或失败。

## 7.6 算法

输入：来自用户对社区系统的不同操作请求

输出：提示用户对应的状态信息

算法流程：

1. 社区模块持续监听，接收请求
2. 前端模块接收来自用户的操作，将请求发送给社区模块
3. 社区模块将请求在链表上排队
4. 检查程序对当前请求和已调度请求进行死锁检查
5. 调度进程池的空闲进程来处理请求
6. 向数据治理模块发出对应的数据请求，和其他模块进行交互
7. 根据用户权限和请求数据等信息完成操作请求
8. 返回给用户对应的状态信息

## 7.7 流程逻辑

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272714.assets)

## 7.8 接口

社区模块与登录模块、前端模块、数据治理模块进行通信交互，相互查询和交换数据信息。在社区模块内部，它具备死锁检查子程序，进程调度子程序，进程池维护子程序，交互通信子程序，业务逻辑子程序等等，它们彼此的相互合作，完成了接收来自用户的操作请求，返回给用户相应的状态信息。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272715.assets)

## 7.9 存储分配

- 社区模块将博客数据、话题数据等数据存储到独立的文件服务器 / 数据库中
- 社区模块挂载在单独的服务器上，运维社区模块子程序所需要的一些局部变量、标识资源常驻在内存中，由不同的子程序单独申请
- 社区模块预先申请了一整块连续的内存存储，用来维护进程池

## 7.10 注释设计 

- 对社区模块的的功能，开发人员，预期功能进行注释
- 对社区模块的不同子程序的执行逻辑，局部变量，返回类型进行注释
- 针对用户的不同操作所设定的不同的分支逻辑进行详细的注释

## 7.11 限制条件 

社区模块包括如下限制条件

- 社区模块必须长期运行在服务器后端后台，避免进程被挂起或kill
- 社区模块必须保证系统空闲内存的大小能够维护进程池的运行，进程池的活跃进程数量不应该太小，避免用户等待时间过长
- 社区模块基于HTTP协议等与前端模块通信，必须保证通信线路的稳定和网络的稳定

## 7.12  测试计划 

测试数据：随机生成一系列用户社区请求，主要关注查询博客、发起博客、搜索博客等热点行为

测试人员：本小组开发人员共同测试

测试方法：采取白盒测试法，对社区模块的逻辑结构、循环结构和执行的基本路径进行检验。通过白盒的方式，监听并检查社区模块内部的执行逻辑，对逻辑路径进行覆盖测试。在不同地方的执行点设立检查点，检查程序的状态，以确定实际运行状态与预期状态是否一致

结果规定：要求社区模块能够在规定的时间内响应并完成用户的操作请求，并保持完成请求后的状态，根据当前状态提示用户相关信息，指示用户的下一步操作。

## 7.13 尚未解决的问题

暂无

# 8 程序6——数据治理模块设计说明

## 8.1 程序描述

数据治理模块是整个项目的数据管理程序，是本项目中所有数据库的顶层管理者。它接受来自其他程序模块的数据请求，并在对应的数据库中进行查找，返回其他模块所请求数据。考虑到用户的请求覆盖了全天24小时，数据库挂载在单独的文件服务器中，我们构建数据治理模块具备以下特点：

- 为常驻内存程序，24小时运行在后端服务器后台监听请求接口
- 是可重入，线程安全的程序，该程序不涉及对IO的读取和内存分配，可以被其它系统调用中断并保证多线程安全性。
- 是并发处理程序，针对来自多模块的请求并发的进行处理
- 是异步通信程序，发出对数据库的请求后不同步等待数据回复，而是异步的发出下一条请求

## 8.2 功能

数据治理模块是本项目中所有数据库的顶层管理者。实际上，无论是评测模块、社区模块等等都需要对数据库进行数据请求，为了避免出现越权访问、多模块同步访问冲突等严重问题，我们采取数据治理模块进行数据隔离，数据治理模块时刻对消息端口进行监听，接收来自其他模块的数据请求并存放在多个优先级队列中，然后数据治理模块根据优先级从队列中取出请求进行处理，首先进行合法性检验，对于检验通过的请求，数据治理模块异步的向对应的数据库发出查询SQL语句，之后异步的处理其他的请求，直到数据库发回对应的数据后，数据治理模块返回给其他的模块。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272716.assets)

## 8.3 性能

数据治理模块肩负着重要的数据治理任务，我们对其性能进行如下要求：

- 精度方面：无特别要求，以数据库精度标准为准
- 灵活性：
  - 要求数据治理模块能够根据请求的优先级进行调度和处理，避免死锁
  - 在数据库扩展时，仅需要添加部分接口就可以完成数据治理模块的更新
- 时间特性：
  - 要求每个请求都能在短时间内得到处理，避免出现请求饥饿
  - 要求所请求的数据能够短时间内传输完毕，避免用户请求延迟大

## 8.4 输入项

来自其他模块的数据请求，包括该数据所在的数据库、数据所在的表、数据的类型、数据的大小、请求数据的模块、数据的返回地址等信息。

## 8.5 输出项

来自数据库的查询结果。如果正确查询，则返回来自其他模块所请求的数据；如果错误查询，则返回错误信息和错误类型。

## 8.6 算法

输入：来自其他模块的数据请求

输出：其他模块所请求的数据

算法流程：

1. 数据治理模块持续监听，接收消息
2. 将接收到的来自其他模块的数据请求存放在多优先级队列中
3. 不断的根据优先级从队列中取出消息进行合法性检查
4. 对于检测合法的请求，向对应的数据库异步发出查询请求
5. 返回其他模块所请求的数据

## 8.7 流程逻辑

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272717.assets)

## 8.8 接口

数据治理模块连接所有其他模块以及数据库服务器，它接收来自其他模块的请求，向数据库发出对应的请求，进而数据库将对应的数据返回给其他模块。

![img](LabWeek14 - Submitting the Detailed Design Specification.assets/-165304064272718.assets)

## 8.9 存储分配 

- 数据治理模块预先申请一整块系统内存用作存储请求的优先级队列
- 基于后台服务长期挂载进程。因此数据治理模块所需要的一些局部变量、传输资源都由编写该模块的高级语言进行申请。
- 所有的数据库都单独存放在另外的文件服务器中

## 8.10 注释设计 

- 对不同数据库的不同操作类型进行详细的注释
- 对模块的功能，开发人员，预期功能进行注释
- 对模块所声明的数据结构，返回数据类型进行注释
- 对模块的执行逻辑进行注释，包括循环、分支等结构

## 8.11 限制条件 

数据治理模块包括如下限制条件

- 数据治理模块必须长期运行在服务器后端后台，避免进程被挂起或kill
- 数据治理模块采取消息传递接口，必须保证通信线路的稳定和网络的稳定
- 数据治理模块的优先级队列必须能够容纳同时并发的请求数量

## 8.12  测试计划 

测试数据：随机模拟并生成一系列用户行为，包括对各类数据的请求

测试人员：本小组开发人员共同测试

测试方法：采取白盒测试法，对数据治理模块的逻辑结构、循环结构和执行的基本路径进行检验。通过白盒的方式，监听并检查治理模块内部的执行逻辑，对逻辑路径进行覆盖测试。在不同地方的执行点设立检查点，检查程序的状态，以确定实际运行状态与预期状态是否一致

结果规定：要求数据治理模块能够在规定的时间内响应请求，在规定的时间内返回数据，并确保数据的正确性和完整性。

## 8.13 尚未解决的问题

暂无
